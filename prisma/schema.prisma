// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

// ────────────────────────────────────────────────
// Enums
// ────────────────────────────────────────────────

enum Role {
  PHYSICIAN
  ADMIN
}

enum Priority {
  ROUTINE
  URGENT
  EMERGENCY
}

enum Status {
  PENDING_ADMIN
  AWAITING_BIODATA
  PENDING_PAYMENT
  PAID
  COMPLETED
  CANCELLED
}

// ────────────────────────────────────────────────
// Models
// ────────────────────────────────────────────────

model User {
  id          String    @id @default(uuid())
  email       String    @unique
  password    String    // hashed with bcrypt
  fullName    String?
  role        Role      @default(PHYSICIAN)
  hospital    String?
  licenseId   String?   // for physicians
  phone       String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  referrals   Referral[] @relation("ReferringPhysician")
  // future: adminReviewed Referrals[]
}

model Referral {
  id                  String    @id @default(uuid())
  referralToken       String    @unique
  patientName         String
  patientId           String?
  patientPhone        String?
  stkPhoneNumber      String?
  patientDOB          DateTime?
  patientNationalId   String?
  medicalHistory      String?   @db.Text
  labResults          String?   @db.Text
  diagnosis           String?
  priority            Priority  @default(ROUTINE)
  status              Status    @default(PENDING_ADMIN)
  referringHospital   String
  receivingFacility   String
  bookedDate          DateTime?
  completedAt         DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  // Relations
  physicianId         String
  physician           User      @relation("ReferringPhysician", fields: [physicianId], references: [id])
}

model Appointment {
  id              String    @id @default(uuid())
  referralId      String    @unique
  referral        Referral  @relation(fields: [referralId], references: [id])
  date            DateTime
  timeSlot        String    // e.g., "10:00-11:00"
  status          String    @default("PENDING") // SCHEDULED, COMPLETED, CANCELLED
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}